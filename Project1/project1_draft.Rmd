---
title: 'Predictive Analysis Project1 : Forecasting'
author: Jered Ataky, Matthew Baker, Christopher Bloome, David Blumenstiel, Dhairav
  Chhatbar
date: "6/6/2021"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Libraries
```{r, warning = FALSE, message=FALSE}
library(dplyr)
library(forecast)
library(readxl)
library(skimr)
library(tidyr)
library(dplyr)
library(seasonal)
library(ggfortify)
library(urca)
library(forecast)
```

## Data Exploration & Preparation

### The data

Read the excel file

```{r, message=FALSE, warning=FALSE}
url<-"https://github.com/jnataky/Predictive_Analytics/raw/main/Project1/Data_Set_for_Class.xls"
temp.file <- paste(tempfile(),".xls",sep = "")
download.file(url, temp.file, mode = "wb")

dataset <- read_excel(temp.file, sheet = 1)

```



Convert the series index to date
```{r}
df <- dataset %>%
  mutate(SeriesInd = as.Date(SeriesInd, origin="1900-01-01"))
head(df)
```

```{r}
df %>%
  group_by(group) %>%
  summarise(var1_NAsum = sum(is.na(Var01)),
            var2_NAsum = sum(is.na(Var02)),
            var3_NAsum = sum(is.na(Var03)),
            var5_NAsum = sum(is.na(Var05)),
            var7_NAsum = sum(is.na(Var07)))
```

Missing data is distributed within the same observations for the most part.  Group has negligable effect on missing values.  
There are about 140 missing observations per group which are the number to forecast.
Drop NA Values
```{r}
df <- df %>% gather("Var", "Value", 3:7) %>% drop_na()
```

### Visulizations

```{r, fig.width=15, fig.height=20}

df$Day <- weekdays(df$SeriesInd)
df %>% ggplot( aes(x=SeriesInd, y=Value, color=group))  + facet_wrap(~Var, scales = "free", ncol = 1) + geom_line() +
  labs(title = "Var Trends by Groups") 
```

```{r, message=FALSE, warning=FALSE}
day_summary <- df %>% select(group, Var, Day) %>% group_by(group, Var, Day) %>% summarise(Days=n()) 
day_summary %>% ggplot( aes(fill=group, y=Days, x=Day)) + geom_bar(position="dodge", stat="identity") + facet_wrap(~Var, scales = "free", ncol = 2) + 
  labs(title="Day Distribution")
```


### Time series

Separating data by group to make different time series
#### S01 Var01
```{r, warning=FALSE}
S01_Var01 <- ts(df %>% filter(group == "S01", Var=="Var01") %>% select(Value), frequency = 365)
S01_Var01 %>% decompose(type="multiplicative") %>% autoplot()
```



#### S01 Var02
```{r, warning=FALSE}
S01_Var02 <- ts(df %>% filter(group == "S01", Var=="Var02") %>% select(Value), frequency = 365)
S01_Var02 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S02 Var02
```{r, warning=FALSE}
S02_Var02 <- ts(df %>% filter(group == "S02", Var=="Var02") %>% select(Value), frequency = 365)
S02_Var02 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S02 Var03
```{r, warning=FALSE}
S02_Var03 <- ts(df %>% filter(group == "S02", Var=="Var03") %>% select(Value), frequency = 365)
S02_Var03 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S03 Var05
```{r, warning=FALSE}
S03_Var05 <- ts(df %>% filter(group == "S03", Var=="Var05") %>% select(Value), frequency = 365)
S03_Var05 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S03 Var07
```{r, warning=FALSE}
S03_Var07 <- ts(df %>% filter(group == "S03", Var=="Var07") %>% select(Value), frequency = 365)
S03_Var07 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S04 Var01
```{r, warning=FALSE}
S04_Var01 <- ts(df %>% filter(group == "S04", Var=="Var01") %>% select(Value), frequency = 365)
S04_Var01 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S04 Var02
```{r, warning=FALSE}
S04_Var02 <- ts(df %>% filter(group == "S04", Var=="Var02") %>% select(Value), frequency = 365)
S04_Var02 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S05 Var02
```{r, warning=FALSE}
S05_Var02 <- ts(df %>% filter(group == "S01", Var=="Var01") %>% select(Value), frequency = 365)
S05_Var02 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S05 Var03
```{r, warning=FALSE}
S05_Var03 <- ts(df %>% filter(group == "S05", Var=="Var03") %>% select(Value), frequency = 365)
S05_Var03 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S06 Var05
```{r, warning=FALSE}
S06_Var05 <- ts(df %>% filter(group == "S06", Var=="Var05") %>% select(Value), frequency = 365)
S06_Var05 %>% decompose(type="multiplicative") %>% autoplot()
```

#### S06 Var07
```{r, warning=FALSE}
S06_Var07 <- ts(df %>% filter(group == "S06", Var=="Var07") %>% select(Value), frequency = 365)
S06_Var07 %>% decompose(type="multiplicative") %>% autoplot()
```




